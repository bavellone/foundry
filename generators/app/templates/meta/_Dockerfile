FROM node:latest

RUN mkdir -p /srv/<%= appNS %>
WORKDIR /srv/<%= appNS %>

# Env vars
ENV NODE_ENV prod
ENV PORT 80

# Install tools
RUN npm install -g bower

# Install deps
COPY bower.json bower.json
RUN bower install --allow-root

COPY package.json package.json
RUN npm install


# Copy over app data
COPY public public
COPY server server
COPY gulpfile.js server.js ./

# Create asset bundles
RUN npm run build

EXPOSE 80
CMD npm start
